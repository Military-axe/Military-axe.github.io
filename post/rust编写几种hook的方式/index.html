<!DOCTYPE html>
<html lang="en"><head>
<title>RustÁºñÂÜôÂá†ÁßçhookÁöÑÊñπÂºè</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="G-XXXXXXXXXX">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:url" content="https://military-axe.github.io/post/rust%E7%BC%96%E5%86%99%E5%87%A0%E7%A7%8Dhook%E7%9A%84%E6%96%B9%E5%BC%8F/">
  <meta property="og:site_name" content="Mi1itray.axe">
  <meta property="og:title" content="RustÁºñÂÜôÂá†ÁßçhookÁöÑÊñπÂºè">
  <meta property="og:description" content="‰ΩøÁî®RustÁºñÂÜôÂá†ÁßçÂú®windows‰∏äÂ∏∏Áî®ÁöÑhookÊñπÂºè:
IAT hook Inline hook VMT hook ‰∏∫‰ªÄ‰πàË¶ÅÁî®rustÁöÑ‰∏çÁî®c&#43;&#43;ÔºüÂ∞±ÊòØÊÉ≥Áî®ÔºåÊÉ≥ÁªôËá™Â∑±ÊâæÈ∫ªÁÉ¶üòé">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-03-22T15:59:44+08:00">
    <meta property="article:modified_time" content="2024-03-22T15:59:44+08:00">
    <meta property="article:tag" content="Retour">
    <meta property="article:tag" content="Inline Hook">
    <meta property="article:tag" content="Vmt Hook">
    <meta property="article:tag" content="Iat Hook">
    <meta property="article:tag" content="Rust">
    <meta property="article:tag" content="Hook">






  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="RustÁºñÂÜôÂá†ÁßçhookÁöÑÊñπÂºè">
  <meta name="twitter:description" content="‰ΩøÁî®RustÁºñÂÜôÂá†ÁßçÂú®windows‰∏äÂ∏∏Áî®ÁöÑhookÊñπÂºè:
IAT hook Inline hook VMT hook ‰∏∫‰ªÄ‰πàË¶ÅÁî®rustÁöÑ‰∏çÁî®c&#43;&#43;ÔºüÂ∞±ÊòØÊÉ≥Áî®ÔºåÊÉ≥ÁªôËá™Â∑±ÊâæÈ∫ªÁÉ¶üòé">







      <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-XXXXXXXXXX');
        }
      </script>




<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "abcdefghzd");
</script>



  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#rust-windows-rs-%e5%ba%93%e4%bd%bf%e7%94%a8" class="nav-rust-windows-rs-Â∫ì‰ΩøÁî®">
									Rust windows-rs Â∫ì‰ΩøÁî®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#features" class="nav-features">
									features
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#32%e4%bd%8d--64%e4%bd%8d--dll" class="nav-32‰Ωç--64‰Ωç--dll">
									32‰Ωç &amp; 64‰Ωç &amp; DLL
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#iat-hook" class="nav-iat-hook">
									IAT hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#inline-hook" class="nav-inline-hook">
									Inline hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#vmt-hook" class="nav-vmt-hook">
									VMT hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%82%e8%80%83" class="nav-ÂèÇËÄÉ">
									ÂèÇËÄÉ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://military-axe.github.io/">
            Mi1itray.axe
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://military-axe.github.io/">
        <div class="single-column-header-title">Mi1itray.axe</div>
        
        <div class="single-column-header-subtitle">mi1itray.axe@gmail.com</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    RustÁºñÂÜôÂá†ÁßçhookÁöÑÊñπÂºè
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-03-22 15:59
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/reverse">Reverse</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/retour">retour</a>
                                &nbsp;
                            
                                <a href="/tags/inline-hook">inline hook</a>
                                &nbsp;
                            
                                <a href="/tags/vmt-hook">vmt hook</a>
                                &nbsp;
                            
                                <a href="/tags/iat-hook">iat hook</a>
                                &nbsp;
                            
                                <a href="/tags/rust">rust</a>
                                &nbsp;
                            
                                <a href="/tags/hook">hook</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>‰ΩøÁî®RustÁºñÂÜôÂá†ÁßçÂú®windows‰∏äÂ∏∏Áî®ÁöÑhookÊñπÂºè:</p>
<ul>
<li>IAT hook</li>
<li>Inline hook</li>
<li>VMT hook</li>
</ul>
<p>‰∏∫‰ªÄ‰πàË¶ÅÁî®rustÁöÑ‰∏çÁî®c++ÔºüÂ∞±ÊòØÊÉ≥Áî®ÔºåÊÉ≥ÁªôËá™Â∑±ÊâæÈ∫ªÁÉ¶üòé</p>
<h1 id="rust-windows-rs-Â∫ì‰ΩøÁî®">Rust windows-rs Â∫ì‰ΩøÁî®</h1>
<p>Êó©Âπ¥ÁöÑÊïôÁ®ãÂ§ßÂ§öÊòØ‰ΩøÁî®<code>winapi</code>Ëøô‰∏™Â∫ìÔºåÂêéÊù•ÂæÆËΩØÂÆòÊñπÂèëÂ∏É‰∫Ü<code>windows-rs</code>ÔºåÊàëÂ∞±ÈÄâÂÆöÁî®ÂÆòÊñπÁöÑÂ∫ìÊù•ÂÅö„ÄÇ‰∏ãÈù¢ÊòØrustÂ∫ìÁöÑ‰∏ÄÂÜôÂü∫Á°ÄÁü•ËØÜ</p>
<h2 id="features">features</h2>
<p><strong>‰ªÄ‰πàÊòØfeaturesÔºü</strong></p>
<p>Âú®ÂÆâË£ÖÂ∫ìÁöÑÊó∂ÂÄôÂ§ßÂ§öÊòØÊó∂ÂÄôÊàë‰ª¨ÈÉΩÊòØ<code>cargo add &lt;Â∫ìÂêçÁß∞&gt;</code>ÂÆâË£Ö‰∏ÄÊï¥‰∏™Â∫ìÔºåÁºñËØëÁöÑÊó∂ÂÄô‰πüÂ∞±Êï¥‰∏™Â∫ìÂèÇ‰∏éÁºñËØëÔºåËÄå<code>features</code>ÂàôÂèØ‰ª•Ëøõ‰∏ÄÊ≠•ÈÄâÊã©Â∫ì‰∏≠ÁâπÂÆöÁöÑÊ®°ÂùóÔºåÊâãÂä®Âú®<code>Cargo.toml</code>Ê∑ªÂä†Âç≥ÂèØ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[dependencies]
</span></span><span style="display:flex;"><span>windows-sys = { version = <span style="color:#cd5555">&#34;0.52.0&#34;</span>, features = [
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_UI_WindowsAndMessaging&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_System_LibraryLoader&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_System_Memory&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_Foundation&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_System_SystemServices&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_System_SystemInformation&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_System_Diagnostics_Debug&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_Security&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#cd5555">&#34;Win32_System_Threading&#34;</span>,
</span></span><span style="display:flex;"><span>] }
</span></span></code></pre></div><p>ÊØîÂ¶Ç<code>windows-sys</code>Â∞±ÊúâÂæàÂ§ö‰∏™featuresÔºå‰∏çÂêåÁöÑapiÂ§Ñ‰∫é‰∏çÂêåÁöÑfeature‰∏ãÔºåÈúÄË¶ÅÊ∑ªÂä†ÂêéÊâçÂèØ‰ª•ÁºñËØë</p>
<p><strong>Êü•ÁúãAPI/ÁªìÊûÑ‰ΩìÂØπÂ∫îÁöÑfearture</strong></p>
<p>Ëøô‰∏™‰∏ÄËà¨Ë¶ÅÁúãÊñáÊ°£ÔºåÊàëËøôÈáåÊêúÁ¥¢ÂØπÂ∫îfeatureÊòØÔºåwindows-rsÂ∫ìÊñáÊ°£‰∏≠‰∏ìÈó®Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÊêúÁ¥¢apiÂØπÂ∫îfeatureÁöÑÂú∞Êñπ</p>
<p><a href="https://microsoft.github.io/windows-rs/features/#/0.53.0">https://microsoft.github.io/windows-rs/features/#/0.53.0</a></p>
<p><img src="https://raw.githubusercontent.com/Military-axe/imgtable/main/202403211356104.png" alt="image-20240321135612069"></p>
<p><strong>windows &amp; window-sys</strong></p>
<p>windows -rsÂ∫ì‰∏ãÊúâ‰∏§‰∏™ÁâàÊú¨Ôºå‰∏Ä‰∏™ÊòØwindowsÔºå‰∏Ä‰∏™ÊòØwindows-sys„ÄÇÂå∫Âà´ÊòØsysÊõ¥Â∫ïÂ±Ç‰∏Ä‰∫õÔºåwindowsÂ∞ÅË£ÖÁöÑÊõ¥Â§ö‰∏Ä‰∫õ.</p>
<h2 id="32‰Ωç--64‰Ωç--dll">32‰Ωç &amp; 64‰Ωç &amp; DLL</h2>
<p>Âú®windows‰∏äÁºñËØë32‰ΩçÁöÑÈúÄË¶ÅrustupÊ∑ªÂä†‰∏Ä‰∏™‰∫§ÂèâÁºñËØëÂπ≥Âè∞„ÄÇ</p>
<p>Êü•ÁúãÊâÄÊúâ‰∫§ÂèâÁºñËØëÂπ≥Âè∞</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rustup target list
</span></span></code></pre></div><p>ÊàëÊòØ64‰Ωç win11ÔºåÂÆâË£Ö‰∏Ä‰∏™32ÁöÑ‰∫§ÂèâÁºñËØë</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rustup target add i686-pc-windows-msvc
</span></span></code></pre></div><p>ÁºñËØë32‰ΩçÁ®ãÂ∫è</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cargo build --target=i686-pc-windows-msvc
</span></span></code></pre></div><p>Â¶ÇÊûúÊä•ÈîôÊâæ‰∏çÂà∞linkerÔºåÈúÄË¶ÅÂú®cargo.toml‰∏≠ÈÖçÁΩÆ‰∏Ä‰∏ãlinkerÔºåÊ†πÊçÆËá™Â∑±ÁöÑË∑ØÂæÑÊù•ÈÖçÁΩÆ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[target.i686-pc-windows-msvc]
</span></span><span style="display:flex;"><span>linker = <span style="color:#cd5555">&#34;C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\\VC\\Tools\\MSVC\\14.24.28314\\bin\\Hostx64\\x86\\link.exe&#34;</span>
</span></span></code></pre></div><p>ÁÑ∂ÂêéÁºñËØëÊàê<strong>dll</strong>ÂàôÈúÄË¶ÅÂú®cargo.toml‰∏≠Ê∑ªÂä†Â¶Ç‰∏ãÂÜÖÂÆπ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[lib]
</span></span><span style="display:flex;"><span>crate-type = [<span style="color:#cd5555">&#34;cdylib&#34;</span>]
</span></span></code></pre></div><h1 id="iat-hook">IAT hook</h1>
<p>ÂØºÂÖ•Ë°®hookÔºå‰ªÄ‰πàÊòØÂØºÂÖ•Ë°®ÔºüÂΩìPEÁ®ãÂ∫èË∞ÉÁî®dll‰∏≠ÁöÑÂáΩÊï∞Êó∂ÔºåÂ∞±Ë¶ÅÂéªËá™Â∑±ÁöÑÂØºÂÖ•Ë°®‰∏≠Êü•Êâædll‰∏≠ÂáΩÊï∞Âú∞ÂùÄÔºåËøô‰∏™IATË°®Âú®Á®ãÂ∫èÂàùÂßãÂåñ‰∏≠Â∞±ÂàùÂßãÂåñÂ•Ω‰∫Ü„ÄÇ</p>
<p>ÂèØ‰ª•ÈÄöËøáCFF exploerÊù•Êü•Êâæ‰Ω†ÊÉ≥hookÁöÑÂáΩÊï∞Âú®ÈÇ£‰∏™dll‰∏≠</p>
<p><img src="https://raw.githubusercontent.com/Military-axe/imgtable/main/202403211549619.png" alt="CFF exploer"></p>
<p>hookÁöÑÊÄùË∑Ø‰πüÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÊõøÊç¢ÊéâË°®‰∏≠ÁöÑÂáΩÊï∞ÊåáÈíàÂÄºÔºå‰øÆÊîπÊàêÊàë‰ª¨ÁöÑÂáΩÊï∞Âú∞ÂùÄ</p>
<p><img src="https://raw.githubusercontent.com/Military-axe/imgtable/main/202403211551812.png" alt=""></p>
<p>Áé∞Âú®ÂÅáËÆæÊàë‰ª¨ÁöÑÁõÆÊ†áÂ∞±ÊòØhook‰∏Ä‰∏™Á®ãÂ∫è‰∏≠ÁöÑ<code>MessageBoxA</code>ÂáΩÊï∞</p>
<p><strong>IAT hook ÂÖàÂÜ≥Êù°‰ª∂</strong></p>
<ol>
<li>È¶ñÂÖàÁõÆÊ†áÁ®ãÂ∫èÈúÄË¶ÅË∞ÉÁî®‰∫Ü<code>MessageBoxA</code>ÂáΩÊï∞</li>
<li>Ëøô‰∏™Á®ãÂ∫èÈúÄË¶ÅË∞ÉÁî®IATË°®‰∏≠ÁöÑ<code>MessageBoxA</code></li>
</ol>
<p>C++ÁâàÊú¨ÁöÑ‰ª£Á†ÅÊúâÂæàÂ§öÔºåÂèØ‰ª•ÂèÇËÄÉ<a href="https://www.ired.team/offensive-security/code-injection-process-injection/import-adress-table-iat-hooking">Red Team Note</a>ÁöÑÁâàÊú¨</p>
<p>ÂÖ≥ÈîÆÈÉ®ÂàÜÊòØÂÆö‰ΩçÂà∞IATË°®ÁÑ∂ÂêéÈÅçÂéÜË°®È°πÔºåÂÆö‰ΩçIATË°®ÈúÄË¶ÅÂÅö‰∏Ä‰∏™PEÂ§¥ÁöÑËß£ÊûêÔºåÊàñËÄÖËØ¥ÂÅèÁßªÔºåÂÖ∑‰ΩìÂ¶Ç‰∏ã</p>
<p>È¶ñÂÖàÈÄöËøáDOSÂ§¥ÁöÑ<code>e_lfanew</code>ÔºàÊúÄÂêé4‰∏™Â≠óËäÇÔºâÂÆö‰ΩçÂà∞NTÂ§¥</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>image_base<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>GetModuleHandleA(null())<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>p_dos_header<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>image_base<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>PimageDosHeader;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>p_nt_headers<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(image_base<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(*p_dos_header).e_lfanew<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>PimageNtHeaders64;<span style="color:#bbb">
</span></span></span></code></pre></div><p>ÁÑ∂ÂêéNTÂ§¥ÁöÑ<code>OptionalHeader--&gt;DataDirArray</code>‰∏≠Á¨¨2È°πÂ∞±ÊòØÂØºÂÖ•Ë°®ÁöÑÂÅèÁßªÔºåÂêåÁêÜÂèØ‰ª•ÂæóÂà∞ÂÖ∂‰ªñË°®ÔºåÂÖ∑‰ΩìÊúâÂì™‰∫õË°®ÂèØ‰ª•Êü•ÊñáÊ°£Ôºå‰∏ãÈù¢ÊòØ010editorÊà™Âõæ</p>
<p><img src="https://raw.githubusercontent.com/Military-axe/imgtable/main/202403211731982.png" alt=""></p>
<p>ÁÑ∂ÂêéÈÅçÂéÜÂØπÊØîÂØºÂÖ•Ë°®‰∏≠ÁöÑÊ®°ÂùóÂêçÊòØÂê¶ÂíåÁõÆÊ†áÊ®°ÂùóÁõ∏ÂêåÔºåÁõ∏ÂêåÂàôÁªßÁª≠ÈÅçÂéÜÊ®°Âùó‰∏≠ÁöÑÂáΩÊï∞ÂêçÔºåÁõ¥Âà∞ÂåπÈÖçÂà∞ÁõÆÊ†áÂáΩÊï∞„ÄÇ</p>
<p>ÂåπÈÖçÂà∞ÁõÆÊ†áÂáΩÊï∞‰πüÂ∞±ÊòØ<code>MessageBoxA</code>ÂêéÔºå‰øÆÊîπÊùÉÈôêÔºåÂÜç‰øÆÊîπÂáΩÊï∞ÊåáÈíàÔºåÂÜç‰øÆÊîπÂõûÂéüÊù•ÁöÑÊùÉÈôê(ÂÖªÊàêÂ•Ω‰π†ÊÉØÔºå‰∏çÁïô‰∏ãÁÉÇÊëäÂ≠ê)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#228b22">/* ‰øÆÊîπIATË°®Â±ûÊÄß‰∏∫ÂèØËØªÂèØÂÜôÂèØÊâßË°å, ÁÑ∂Âêé‰øÆÊîπÂØπÂ∫îIATË°®È°πÂÄº‰∏∫hookÂáΩÊï∞ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#228b22">/* Áî±‰∫éÂè™ÊòØ‰øÆÊîπIATË°®‰∏≠ÁöÑ‰∏Ä‰∏™ÊåáÈíàÔºåÊâÄ‰ª•Â§ßÂ∞èÁõ¥Êé•0x1000Ôºå‰∏ç‰ºöÊúâÂ§ßÂ∞èÁöÑÈôêÂà∂ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_protection<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">0</span><span style="color:#8b008b;font-weight:bold">u32</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>VirtualProtect(p_func<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_,<span style="color:#bbb"> </span><span style="color:#b452cd">0x1000</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PAGE_EXECUTE_READWRITE</span>,<span style="color:#bbb"> </span>&amp;<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_protection<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>*p_func<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>new_func_address;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>VirtualProtect(p_func<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_,<span style="color:#bbb"> </span><span style="color:#b452cd">0x1000</span>,<span style="color:#bbb"> </span>old_protection,<span style="color:#bbb"> </span>&amp;<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_protection<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_);<span style="color:#bbb">
</span></span></span></code></pre></div><p>ËøôÊ†∑Â∞±ÂèØ‰ª•‰∫ÜÔºåÈúÄË¶ÅËÆ∞ÂæóÂÜçÂÆûÁé∞‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑ<code>new_func_address</code>‰πüÂ∞±ÊòØÊàë‰ª¨Ëá™Â∑±hookÁöÑÂáΩÊï∞</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">hook_message_box_a</span>(h_wnd: <span style="color:#008b45;font-weight:bold">HWND</span>,<span style="color:#bbb"> </span>_: <span style="color:#008b45;font-weight:bold">PCSTR</span>,<span style="color:#bbb"> </span>_: <span style="color:#008b45;font-weight:bold">PCSTR</span>,<span style="color:#bbb"> </span>u_type: <span style="color:#00688b;font-weight:bold">u32</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#00688b;font-weight:bold">i32</span> {<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>(*(&amp;<span style="color:#00688b">MESSAGE_BOX_A_HOOK_ADDRESS</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span>_<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>MessageBoxWHook))(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>h_wnd,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>s!(<span style="color:#cd5555">&#34;Ops hooked by mi1itray.axe!&#34;</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>s!(<span style="color:#cd5555">&#34;Ops hooked by mi1itray.axe!&#34;</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>u_type,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>RustÁâàÊú¨64‰Ωç‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>core::ptr::null;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::os::raw::c_void;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows_sys::{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>core::*,<span style="color:#bbb"> </span>Win32::Foundation::*,<span style="color:#bbb"> </span>Win32::System::Diagnostics::Debug::<span style="color:#00688b">IMAGE_NT_HEADERS64</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Win32::System::LibraryLoader::*,<span style="color:#bbb"> </span>Win32::System::Memory::*,<span style="color:#bbb"> </span>Win32::System::SystemServices::*,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Win32::<span style="color:#00688b">UI</span>::WindowsAndMessaging::*,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#228b22">// ÂÆö‰πâ‰∏Ä‰∏™Âà´Âêç
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">MessageBoxWHook</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span>(<span style="color:#00688b">HWND</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u32</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#00688b;font-weight:bold">i32</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">LPVOID</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>c_void;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">PimageNtHeaders64</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span><span style="color:#00688b">IMAGE_NT_HEADERS64</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">PimageImportDescriptor</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span><span style="color:#00688b">IMAGE_IMPORT_DESCRIPTOR</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">PimageDosHeader</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span><span style="color:#00688b">IMAGE_DOS_HEADER</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#228b22">// ‰øùÂ≠òÂéüÂáΩÊï∞Âú∞ÂùÄÔºåÂΩìÁÑ∂ËøôÈáåÂèØ‰ª•Áî®ÊåáÈíàÂÖ∑‰ΩìÂÜôÊ≥ïÂêéÈù¢ÂçïÁã¨‰ªãÁªç
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span><span style="color:#00688b">MESSAGE_BOX_A_HOOK_ADDRESS</span>: <span style="color:#00688b;font-weight:bold">u64</span> =<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#228b22">// ‰∏§‰∏™Ë∞ÉËØïÁöÑÊó∂ÂÄô‰ΩøÁî®ÁöÑÂáΩÊï∞ÔºåÁî®‰∫éËæìÂÖ•Error‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#1e889b">#[allow(dead_code)]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">clear_last_error</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>SetLastError(<span style="color:#b452cd">0</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#1e889b">#[allow(dead_code)]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">show_last_error</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>e<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>format!(<span style="color:#cd5555">&#34;</span><span style="color:#cd5555">{:?}</span><span style="color:#cd5555">\0</span><span style="color:#cd5555">&#34;</span>,<span style="color:#bbb"> </span>GetLastError()).as_ptr();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>MessageBoxA(<span style="color:#b452cd">0</span>,<span style="color:#bbb"> </span>e,<span style="color:#bbb"> </span>s!(<span style="color:#cd5555">&#34;Warn&#34;</span>),<span style="color:#bbb"> </span><span style="color:#00688b">MB_OK</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#cd5555">/// `hook_message_box_a`ÊòØÊàë‰ª¨Ëá™ÂÆö‰πâÁöÑmessageboxÂáΩÊï∞ÔºåÁî®‰∫éÊõøÊç¢ÊéâÂéüÊù•ÁöÑ`MessageBoxA`ÂáΩÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// ÊïàÊûúÊòØÂºπÂá∫‰∏Ä‰∏™Ê∂àÊÅØÊ°ÜÔºå‰∏ª‰ΩìÂÜÖÂÆπÂíåÊ†áÈ¢òÊ†èÂÜÖÂÆπÈÉΩÊòØ**Ops hooked by mi1itray.axe!**
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// # ÂèÇÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// ÂèÇÊï∞‰∏éÂéüÊú¨ÁöÑ`MessageBoxA`ÂáΩÊï∞Â£∞ÊòéÁõ∏Âêå
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">hook_message_box_a</span>(h_wnd: <span style="color:#008b45;font-weight:bold">HWND</span>,<span style="color:#bbb"> </span>_: <span style="color:#008b45;font-weight:bold">PCSTR</span>,<span style="color:#bbb"> </span>_: <span style="color:#008b45;font-weight:bold">PCSTR</span>,<span style="color:#bbb"> </span>u_type: <span style="color:#00688b;font-weight:bold">u32</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#00688b;font-weight:bold">i32</span> {<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>(*(&amp;<span style="color:#00688b">MESSAGE_BOX_A_HOOK_ADDRESS</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span>_<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>MessageBoxWHook))(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>h_wnd,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>s!(<span style="color:#cd5555">&#34;Ops hooked by mi1itray.axe!&#34;</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>s!(<span style="color:#cd5555">&#34;Ops hooked by mi1itray.axe!&#34;</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>u_type,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#cd5555">/// `detour`ÊâßË°åhookÈÄªËæëÁöÑÂáΩÊï∞ÔºåÂ∞ÜÊåáÂÆöÊ®°Âùó‰∏≠ÊåáÂÆöÂÅèÁßªÂÄºÁöÑÂáΩÊï∞ÊåáÈíàÊõøÊç¢ÊàêÊåáÂÆöÁöÑÊñ∞ÂáΩÊï∞Âú∞ÂùÄÂÄº„ÄÇ
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// È¶ñÂÖàÈÅçÂéÜÊ®°ÂùóÂàóË°®ÔºåÁõ¥Âà∞ÂØπÊØîÂá∫Áõ∏ÂêåÁöÑÊ®°ÂùóÂêçÁß∞„ÄÇÁÑ∂Âêé
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// # ÂèÇÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// - `module_name`: ÊåáÂêëÊ®°ÂùóÂêçÁß∞ÂÜÖÂ≠òÁöÑÊåáÈíàÔºåÁ±ªÂûãÊòØ`*const u8`
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// - `old_func_offset`: ÂéüÊú¨ÂáΩÊï∞ÊåáÈíàÂú®Ê®°Âùó‰∏äIATË°®‰∏≠ÁöÑÂÅèÁßª
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// - `new_func_address`: ÊõøÊç¢ÁöÑÂáΩÊï∞ÊåáÈíàÂú∞ÂùÄÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// # ËøîÂõûÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// Â¶ÇÊûúhookÊàêÂäüÂàôËøîÂõûÂéüÂßãÂáΩÊï∞ÁöÑÂú∞ÂùÄÔºåÂ¶ÇÊûúÂ§±Ë¥•ÂàôËøîÂõû0
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// # ‰æãÂ≠ê
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">///
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// ```rust
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// detour(&#34;USER32.dll\0&#34;.as_ptr() as _, 0x72AD0, hook_message_box_w as _);
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// ```
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">detour</span>(module_name: *<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u8</span>,<span style="color:#bbb"> </span>old_func_offset: <span style="color:#00688b;font-weight:bold">u64</span>,<span style="color:#bbb"> </span>new_func_address: <span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#00688b;font-weight:bold">u64</span> {<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>module_address<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>GetModuleHandleA(module_name)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>old_func_address<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>module_address<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>old_func_offset;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>image_base<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>GetModuleHandleA(null())<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>p_dos_header<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>image_base<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>PimageDosHeader;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>p_nt_headers<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(image_base<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(*p_dos_header).e_lfanew<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>PimageNtHeaders64;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>p_import_descriptor<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(image_base<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>+<span style="color:#bbb"> </span>(*p_nt_headers).OptionalHeader.DataDirectory[<span style="color:#b452cd">1</span>].VirtualAddress<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>PimageImportDescriptor;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">while</span><span style="color:#bbb"> </span>(*p_import_descriptor).FirstThunk<span style="color:#bbb"> </span>!=<span style="color:#bbb"> </span><span style="color:#b452cd">0</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#228b22">/* ÂØπÊØîÂØºÂÖ•Ë°®È°πÂêçÁß∞‰∏éÁõÆÊ†áÊòØÂê¶Á¨¶ÂêàÔºå‰∏çÁ¨¶ÂêàÂàôÁõ¥Êé•ÂÅèÁßªÂØºÂÖ•Ë°®‰∏ã‰∏ÄÈ°π */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">if</span><span style="color:#bbb"> </span>module_name.eq(&amp;((image_base<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(*p_import_descriptor).Name<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u8</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>p_import_descriptor<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>p_import_descriptor.offset(<span style="color:#b452cd">1</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#8b008b;font-weight:bold">continue</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#228b22">/* ÂåπÈÖçÂà∞ÁõÆÊ†áÊ®°Âùó, ÂºπÂá∫‰∏Ä‰∏™Ê∂àÊÅØÊ°Ü */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>module_name<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(image_base<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(*p_import_descriptor).Name<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u8</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>MessageBoxA(<span style="color:#b452cd">0</span>,<span style="color:#bbb"> </span>module_name,<span style="color:#bbb"> </span>s!(<span style="color:#cd5555">&#34;Module name&#34;</span>),<span style="color:#bbb"> </span><span style="color:#00688b">MB_OK</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#228b22">/* ÈÅçÂéÜÂØºÂÖ•Ë°® */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>p_func<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(image_base<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(*p_import_descriptor).FirstThunk<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">for</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#b452cd">0</span>..<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#8b008b;font-weight:bold">if</span><span style="color:#bbb"> </span>p_func.is_null()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#8b008b;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#b452cd">0</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#228b22">/* ÂåπÈÖçÂà∞ÂØºÂÖ•Ë°®ÂáΩÊï∞ÔºåÂºπÂá∫‰∏Ä‰∏™Ê∂àÊÅØÊ°Ü */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>func_name<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#00688b">PCSTR</span>::from(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>(image_base<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>+<span style="color:#bbb"> </span>(*((image_base<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(*p_import_descriptor).Anonymous.OriginalFirstThunk<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                        </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u64</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                        </span>.offset(i))<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>+<span style="color:#bbb"> </span><span style="color:#b452cd">2</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>*<span style="color:#8b008b;font-weight:bold">const</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u8</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#8b008b;font-weight:bold">if</span><span style="color:#bbb"> </span>old_func_address<span style="color:#bbb"> </span>==<span style="color:#bbb"> </span>*p_func<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>MessageBoxA(<span style="color:#b452cd">0</span>,<span style="color:#bbb"> </span>func_name,<span style="color:#bbb"> </span>s!(<span style="color:#cd5555">&#34;Find Func&#34;</span>),<span style="color:#bbb"> </span><span style="color:#00688b">MB_OK</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#228b22">/* ‰øÆÊîπIATË°®Â±ûÊÄß‰∏∫ÂèØËØªÂèØÂÜôÂèØÊâßË°å, ÁÑ∂Âêé‰øÆÊîπÂØπÂ∫îIATË°®È°πÂÄº‰∏∫hookÂáΩÊï∞ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#228b22">/* Áî±‰∫éÂè™ÊòØ‰øÆÊîπIATË°®‰∏≠ÁöÑ‰∏Ä‰∏™ÊåáÈíàÔºåÊâÄ‰ª•Â§ßÂ∞èÁõ¥Êé•0x1000Ôºå‰∏ç‰ºöÊúâÂ§ßÂ∞èÁöÑÈôêÂà∂ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_protection<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">0</span><span style="color:#8b008b;font-weight:bold">u32</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>VirtualProtect(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>p_func<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#b452cd">0x1000</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#00688b">PAGE_EXECUTE_READWRITE</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>&amp;<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_protection<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>*p_func<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>new_func_address;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#228b22">/* ‰øÆÊîπÂõûÂéüÊù•ÁöÑÂ±ûÊÄß */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>VirtualProtect(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>p_func<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#b452cd">0x1000</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>old_protection,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>&amp;<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_protection<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#8b008b;font-weight:bold">return</span><span style="color:#bbb"> </span>old_func_address;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>p_func<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>p_func.offset(<span style="color:#b452cd">1</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#b452cd">0</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#b452cd">0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#cd5555">/// `init_hook` ‰æãÁ®ãÊâßË°åÂáΩÊï∞ÔºåË∞ÉÁî®`detour`ÂáΩÊï∞ÔºåIAThookÂáΩÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">/// ÂÖ∂‰∏≠ÁöÑ`0x79730`ÊòØÊàëÊú¨Êú∫‰∏äuser32.dll‰∏≠Âü∫Âú∞ÂùÄÂà∞MessageBoxAÁöÑÂÅèÁßªÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">init_hook</span>()<span style="color:#bbb"> </span>-&gt; <span style="color:#00688b;font-weight:bold">u32</span> {<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00688b">MESSAGE_BOX_A_HOOK_ADDRESS</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>detour(s!(<span style="color:#cd5555">&#34;USER32.dll&#34;</span>),<span style="color:#bbb"> </span><span style="color:#b452cd">0x79730</span>,<span style="color:#bbb"> </span>hook_message_box_a<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#b452cd">0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#1e889b">#[no_mangle]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#1e889b">#[allow(non_snake_case)]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">pub</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">DllMain</span>(_: <span style="color:#00688b;font-weight:bold">isize</span>,<span style="color:#bbb"> </span>reason: <span style="color:#00688b;font-weight:bold">u32</span>,<span style="color:#bbb"> </span>_: <span style="color:#008b45;font-weight:bold">LPVOID</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#00688b;font-weight:bold">i32</span> {<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">match</span><span style="color:#bbb"> </span>reason<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_PROCESS_ATTACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>MessageBoxA(<span style="color:#b452cd">0</span>,<span style="color:#bbb"> </span>s!(<span style="color:#cd5555">&#34;Inject dll success&#34;</span>),<span style="color:#bbb"> </span>s!(<span style="color:#cd5555">&#34;Step 1&#34;</span>),<span style="color:#bbb"> </span><span style="color:#00688b">MB_OK</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>init_hook();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>},<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_PROCESS_DETACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>(),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_THREAD_ATTACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>(),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_THREAD_DETACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>(),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>_<span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>(),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#b452cd">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></div><h1 id="inline-hook">Inline hook</h1>
<p>inline hookÊòØhookÂÆåËøô‰∏™ÂáΩÊï∞Âêé</p>
<ul>
<li>
<p>È¶ñÂÖàË¶ÅÂ∞ÜÂéüÂßãÂáΩÊï∞ÁöÑÂèÇÊï∞ÂÄºÈÉΩÂ≠òÂÖ•Ê†à‰∏≠</p>
</li>
<li>
<p>ÁÑ∂ÂêéÂÜçË∑≥ËΩ¨Ëá™ÂÆö‰πâhookÂáΩÊï∞</p>
</li>
<li>
<p>ÊâßË°åÂÆåÊàë‰ª¨ÁöÑÂáΩÊï∞ÂêéÂõûÂà∞ÂéüÂßãÂáΩÊï∞</p>
</li>
<li>
<p>ÂÜçÊÅ¢Â§çÂéüÂßãÂáΩÊï∞ÁöÑÂèÇÊï∞ÔºåËÆ©ÂéüÂßãÂáΩÊï∞ÁªßÁª≠Ê≠£Â∏∏ËøêË°å„ÄÇ</p>
</li>
</ul>
<p>ÁõÆÁöÑÂ∞±ÊòØÂáèÂ∞èÂΩ±Âìç„ÄÇËøôÁßçÊñπÊ≥ïÊïàÊûúÊúÄÂ•ΩÔºåÂ∫îÁî®Âú∫ÊôØÂπøÔºåÊ≤°ÊúâÈôêÂà∂Ôºõ‰ΩÜÊòØÈúÄË¶ÅÂÜôÊ±áÁºñËØ≠Âè•Êù•Â∞ÜÂèÇÊï∞Â≠òÂÖ•Ê†à‰∏≠ÔºåÂêåÊó∂ÈúÄË¶ÅÊ†πÊçÆhookÂáΩÊï∞Á¶ªhook‰ΩçÁΩÆÊù•ÂÜ≥ÂÆöÊòØË¶Å<strong>ÈïøË∑≥ËΩ¨ËøòÊòØÁü≠Ë∑≥ËΩ¨</strong>„ÄÇ</p>
<p>Â•ΩÂú®ÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∫õhookÊ°ÜÊû∂Êù•Èôç‰ΩéÈöæÂ∫¶Ôºåwindows‰∏ãcËØ≠Ë®ÄÂæàÂ§öÊ°ÜÊû∂ÔºådetourÔºåminihookÁ≠âÔºårustÈÄâÊã©Â∞±ÊØîËæÉÂ∞ëÔºå‰πãÂâçÊØîËæÉÊúâÂêçÁöÑÊòØdetourÔºå‰ΩÜÊòØ‰ª•ÂèäÂÅúÊ≠¢Áª¥Êä§‰∫Ü„ÄÇÊâÄ‰ª•ÊàëËøôÈáå‰ΩøÁî®ÁöÑÊòØ<a href="https://github.com/Hpmason/retour-rs">retour</a>Ôºå‰∏Ä‰∏™detourÁöÑforkÁª¥Êä§ÁâàÊú¨</p>
<p>‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÂÆòÊñπÁöÑ‰ª£Á†ÅÔºåÊòØhook <code>MessageBoxW</code>ÁöÑ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#cd5555">//! A `MessageBoxW` detour example.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">//!
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555">//! Ensure the crate is compiled as a &#39;cdylib&#39; library to allow C interop.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>retour::static_detour;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::error::Error;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::ffi::c_int;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::os::raw::c_void;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::{ffi::CString,<span style="color:#bbb"> </span>iter,<span style="color:#bbb"> </span>mem};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows::core::{<span style="color:#00688b">PCSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCWSTR</span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows::w;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows::Win32::Foundation::{<span style="color:#00688b">BOOL</span>,<span style="color:#bbb"> </span><span style="color:#00688b">HANDLE</span>,<span style="color:#bbb"> </span><span style="color:#00688b">HWND</span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows::Win32::System::LibraryLoader::{GetModuleHandleW,<span style="color:#bbb"> </span>GetProcAddress};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows::Win32::System::SystemServices::{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00688b">DLL_PROCESS_ATTACH</span>,<span style="color:#bbb"> </span><span style="color:#00688b">DLL_PROCESS_DETACH</span>,<span style="color:#bbb"> </span><span style="color:#00688b">DLL_THREAD_ATTACH</span>,<span style="color:#bbb"> </span><span style="color:#00688b">DLL_THREAD_DETACH</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>static_detour!<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">static</span><span style="color:#bbb"> </span>MessageBoxWHook: <span style="color:#008b45;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span>(<span style="color:#00688b">HWND</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCWSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCWSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u32</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#008b45;font-weight:bold">c_int</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#228b22">// A type alias for `MessageBoxW` (makes the transmute easy on the eyes)
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">FnMessageBoxW</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span>(<span style="color:#00688b">HWND</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCWSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b">PCWSTR</span>,<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">u32</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#008b45;font-weight:bold">c_int</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#cd5555">/// Called when the DLL is attached to the process.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">main</span>()<span style="color:#bbb"> </span>-&gt; <span style="color:#658b00">Result</span>&lt;(),<span style="color:#bbb"> </span><span style="color:#658b00">Box</span>&lt;<span style="color:#8b008b;font-weight:bold">dyn</span><span style="color:#bbb"> </span>Error&gt;&gt;<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#228b22">// Retrieve an absolute address of `MessageBoxW`. This is required for
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span><span style="color:#228b22">// libraries due to the import address table. If `MessageBoxW` would be
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span><span style="color:#228b22">// provided directly as the target, it would only hook this DLL&#39;s
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span><span style="color:#228b22">// `MessageBoxW`. Using the method below an absolute address is retrieved
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span><span style="color:#228b22">// instead, detouring all invocations of `MessageBoxW` in the active process.
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>address<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>get_module_symbol_address(<span style="color:#cd5555">&#34;user32.dll&#34;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#34;MessageBoxW&#34;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>.expect(<span style="color:#cd5555">&#34;could not find &#39;MessageBoxW&#39; address&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>target: <span style="color:#008b45;font-weight:bold">FnMessageBoxW</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>mem::transmute(address);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#228b22">// Initialize AND enable the detour (the 2nd parameter can also be a closure)
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span>MessageBoxWHook<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>.initialize(target,<span style="color:#bbb"> </span>messageboxw_detour)?<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>.enable()?;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#658b00">Ok</span>(())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#cd5555">/// Called whenever `MessageBoxW` is invoked in the process.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">messageboxw_detour</span>(hwnd: <span style="color:#008b45;font-weight:bold">HWND</span>,<span style="color:#bbb"> </span>text: <span style="color:#008b45;font-weight:bold">PCWSTR</span>,<span style="color:#bbb"> </span>_caption: <span style="color:#008b45;font-weight:bold">PCWSTR</span>,<span style="color:#bbb"> </span>msgbox_style: <span style="color:#00688b;font-weight:bold">u32</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#008b45;font-weight:bold">c_int</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#228b22">// Call the original `MessageBoxW`, but replace the caption
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>replaced_caption<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>w!(<span style="color:#cd5555">&#34;Detoured!&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb"> </span>MessageBoxWHook.call(hwnd,<span style="color:#bbb"> </span>text,<span style="color:#bbb"> </span>replaced_caption,<span style="color:#bbb"> </span>msgbox_style)<span style="color:#bbb"> </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#cd5555">/// Returns a module symbol&#39;s absolute address.
</span></span></span><span style="display:flex;"><span><span style="color:#cd5555"></span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">get_module_symbol_address</span>(module: <span style="color:#8b008b;font-weight:bold">&amp;</span><span style="color:#00688b;font-weight:bold">str</span>,<span style="color:#bbb"> </span>symbol: <span style="color:#8b008b;font-weight:bold">&amp;</span><span style="color:#00688b;font-weight:bold">str</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#658b00">Option</span>&lt;<span style="color:#00688b;font-weight:bold">usize</span>&gt;<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>module<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>module<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>.encode_utf16()<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>.chain(iter::once(<span style="color:#b452cd">0</span>))<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>.collect::&lt;<span style="color:#658b00">Vec</span>&lt;<span style="color:#00688b;font-weight:bold">u16</span>&gt;&gt;();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>symbol<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>CString::new(symbol).unwrap();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>handle<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>GetModuleHandleW(<span style="color:#00688b">PCWSTR</span>(module.as_ptr()<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_)).unwrap();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#8b008b;font-weight:bold">match</span><span style="color:#bbb"> </span>GetProcAddress(handle,<span style="color:#bbb"> </span><span style="color:#00688b">PCSTR</span>(symbol.as_ptr()<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span>_))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#658b00">Some</span>(func)<span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span><span style="color:#658b00">Some</span>(func<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">usize</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#658b00">None</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span><span style="color:#658b00">None</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#1e889b">#[no_mangle]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">DllMain</span>(_hinst: <span style="color:#008b45;font-weight:bold">HANDLE</span>,<span style="color:#bbb"> </span>reason: <span style="color:#00688b;font-weight:bold">u32</span>,<span style="color:#bbb"> </span>_reserved: *<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>c_void)<span style="color:#bbb"> </span>-&gt; <span style="color:#008b45;font-weight:bold">BOOL</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">match</span><span style="color:#bbb"> </span>reason<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_PROCESS_ATTACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>println!(<span style="color:#cd5555">&#34;attaching&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb"> </span>main().unwrap()<span style="color:#bbb"> </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_PROCESS_DETACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>println!(<span style="color:#cd5555">&#34;detaching&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_THREAD_ATTACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_THREAD_DETACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>_<span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#00688b">BOOL</span>::from(<span style="color:#8b008b;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>ÁúãÂÆåÊàëÂè™ËÉΩËØ¥Ôºå‰ºòÈõÖÔºåÂ§™‰ºòÈõÖ‰∫ÜÔºÅÂÆõÂ¶ÇÊ±âÂ∞ºÊãîÂÅö‰∫∫‰∏ÄÊ†∑ÁöÑ‰ºòÈõÖ„ÄÇ</p>
<h1 id="vmt-hook">VMT hook</h1>
<p>ËôöË°®hookÔºåÂú®c++‰∏≠Ôºå‰∏Ä‰∏™Á±ªÂ¶ÇÊûú‰ΩøÁî®Âà∞‰∫ÜËôöÂáΩÊï∞ÔºåÂ∞±‰ºöÊúâËôöË°®„ÄÇËøô‰∏™ËôöË°®Âè™Â±û‰∫éËøô‰∏™Á±ªÔºåËøô‰∏™Á±ªÁöÑÂØπË±°ÈÉΩÊúâÊåáÂêëËøô‰∏™ËôöË°®ÁöÑÊåáÈíà</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR

	A(Á±ªAÁöÑÂØπË±°1) --&gt; B(Á±ªAËôöË°®)
	C(Á±ªAÁöÑÂØπË±°2) --&gt; B
	B --&gt; D(Á±ªAÁöÑËôöÂáΩÊï∞)
</code></pre><p>ÂÖàÂÜô‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#1e889b">#include</span> <span style="color:#1e889b">&lt;iostream&gt;</span><span style="color:#1e889b">
</span></span></span><span style="display:flex;"><span><span style="color:#1e889b"></span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">using</span> <span style="color:#8b008b;font-weight:bold">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Base</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">virtual</span> <span style="color:#00688b;font-weight:bold">void</span> func1() { cout &lt;&lt; <span style="color:#cd5555">&#34;func1()&#34;</span> &lt;&lt; endl; }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">virtual</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">func2</span>() { cout &lt;&lt; <span style="color:#cd5555">&#34;func2()&#34;</span> &lt;&lt; endl; }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">virtual</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">func3</span>() { cout &lt;&lt; <span style="color:#cd5555">&#34;func3()&#34;</span> &lt;&lt; endl; }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00688b;font-weight:bold">int</span> <span style="color:#008b45">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Base t;
</span></span><span style="display:flex;"><span>    (((<span style="color:#00688b;font-weight:bold">void</span> (*)()) * ((<span style="color:#00688b;font-weight:bold">int</span>*)(*((<span style="color:#00688b;font-weight:bold">int</span>*)&amp;t)) + <span style="color:#b452cd">0</span>)))();
</span></span><span style="display:flex;"><span>    (((<span style="color:#00688b;font-weight:bold">void</span> (*)()) * ((<span style="color:#00688b;font-weight:bold">int</span>*)(*((<span style="color:#00688b;font-weight:bold">int</span>*)&amp;t)) + <span style="color:#b452cd">1</span>)))();
</span></span><span style="display:flex;"><span>    (((<span style="color:#00688b;font-weight:bold">void</span> (*)()) * ((<span style="color:#00688b;font-weight:bold">int</span>*)(*((<span style="color:#00688b;font-weight:bold">int</span>*)&amp;t)) + <span style="color:#b452cd">2</span>)))();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#b452cd">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ËøêË°åÂêéÂèØ‰ª•ÁúãÂà∞</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> ‚ùØ‚ùØ mi1it ‚ùØ‚ùØ .<span style="color:#cd5555">\v</span>mt.exe
</span></span><span style="display:flex;"><span>func1()
</span></span><span style="display:flex;"><span>func2()
</span></span><span style="display:flex;"><span>func3()
</span></span></code></pre></div><p>g++ÁºñËØëÊàêx86Êû∂ÊûÑÁöÑÔºå‰ΩøÁî®idaÊâìÂºÄÂàÜÊûê‰∏Ä‰∏ã</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">.rdata:004052A8 ; public Base
.rdata:004052A8                 public __ZTI4Base
.rdata:004052A8 ; `typeinfo for&#39;Base
.rdata:004052A8 __ZTI4Base      dd offset __imp___ZTVN10__cxxabiv117__class_type_infoE+8
.rdata:004052A8                                         ; DATA XREF: .rdata:004052BC‚Üìo
.rdata:004052A8                                         ; reference to RTTI&#39;s type class
.rdata:004052AC                 dd offset __ZTS4Base    ; reference to type&#39;s name
.rdata:004052B0                 public __ZTS4Base
.rdata:004052B0 ; `typeinfo name for&#39;Base
.rdata:004052B0 __ZTS4Base      db &#39;4Base&#39;,0            ; DATA XREF: .rdata:004052AC‚Üëo
.rdata:004052B0                                         ; type descriptor name
.rdata:004052B6                 align 4
.rdata:004052B8                 public __ZTV4Base
.rdata:004052B8 ; `vtable for&#39;Base
.rdata:004052B8 __ZTV4Base      dd 0                    ; offset to this
.rdata:004052BC                 dd offset __ZTI4Base    ; `typeinfo for&#39;Base
.rdata:004052C0 virtual         dd offset __ZN4Base5func1Ev
.rdata:004052C0                                         ; DATA XREF: _main+E‚Üëo
.rdata:004052C0                                         ; Base::func1(void)
.rdata:004052C4                 dd offset __ZN4Base5func2Ev ; Base::func2(void)
.rdata:004052C8                 dd offset __ZN4Base5func3Ev ; Base::func3(void)
</code></pre><p>ÂèØ‰ª•ÁúãÂà∞‰∏Ä‰∏™BaseÁ±ªÁöÑÁªìÊûÑÔºåÂú®thisÊåáÈíàÂÅèÁßª2ÁöÑ‰ΩçÁΩÆÂ∞±ÊòØËôöË°®ÔºåÂàÜÂà´ÊåáÂêë3‰∏™ËôöÂáΩÊï∞„ÄÇ‰ΩÜÊòØËøôÊòØÁ±ªÁöÑÁªìÊûÑÔºå‰∏çÊòØÂØπË±°ÁöÑÁªìÊûÑ„ÄÇ‰∏Ä‰∏™ÂÆû‰æãÂØπË±°ÁöÑÂú∞ÂùÄÊåáÂêëÁöÑÂ∞±ÊòØËôöË°®ÔºåÊâÄ‰ª•‰ª£Á†Å‰∏≠ÂÆû‰æãtÁõ¥Êé•ÈÄöËøáÂÅèÁßªÂèØ‰ª•ÂæóÂà∞ÂáΩÊï∞Âú∞ÂùÄ„ÄÇ</p>
<p>Â¶ÇÊûúÊàë‰øÆÊîπVMT‰∏≠ÁöÑ‰∏Ä‰∏™ÂáΩÊï∞ÊåáÈíàÔºåÂΩìËøô‰∏™Ëøô‰∏™ÂáΩÊï∞Ë¢´Ë∞ÉÁî®ÁöÑÊó∂ÂÄôÂ∞±ËææÂà∞‰∫ÜhookÁöÑÊïàÊûú„ÄÇÂü∫‰∫éËøôÁßçËôöË°®ÔºåÂèØ‰ª•‰øÆÊîπË°®ÁöÑÂÜÖÂÆπÔºåÂ∞±ÂÉèIAT hookÔºåÊàñËÄÖÁõ¥Êé•hookËôöÂáΩÊï∞Êú¨Ë∫´ÔºåÂ∞±Á±ª‰ººinline hookÁöÑ„ÄÇ</p>
<p>Âü∫‰∫éretourÂÜô‰∏Ä‰∏™Á±ª‰ººinlinr hookÁöÑÂ∞±ÂèØ‰ª•</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::ptr::null;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::error::Error;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::mem;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows_sys::Win32::System::LibraryLoader::*;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows_sys::Win32::Foundation::{<span style="color:#00688b">BOOL</span>,<span style="color:#bbb"> </span><span style="color:#00688b">HANDLE</span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>std::os::raw::c_void;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>retour::static_detour;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">use</span><span style="color:#bbb"> </span>windows_sys::Win32::System::SystemServices::{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#00688b">DLL_PROCESS_ATTACH</span>,<span style="color:#bbb"> </span><span style="color:#00688b">DLL_PROCESS_DETACH</span>,<span style="color:#bbb"> </span><span style="color:#00688b">DLL_THREAD_ATTACH</span>,<span style="color:#bbb"> </span><span style="color:#00688b">DLL_THREAD_DETACH</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>static_detour!<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">static</span><span style="color:#bbb"> </span>HookIt: <span style="color:#008b45;font-weight:bold">fn</span>();<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">type</span> <span style="color:#008b45;font-weight:bold">BaseF1</span><span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">get_func_address</span>(offset: <span style="color:#00688b;font-weight:bold">usize</span>)<span style="color:#bbb"> </span>-&gt; <span style="color:#008b45;font-weight:bold">BaseF1</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>handle<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb"> </span>GetModuleHandleA(null())<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">usize</span><span style="color:#bbb"> </span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb"> </span>mem::transmute::&lt;<span style="color:#00688b;font-weight:bold">usize</span>,<span style="color:#bbb"> </span>BaseF1&gt;(<span style="color:#bbb"> </span>offset<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>handle)<span style="color:#bbb"> </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">detour</span>()<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>println!(<span style="color:#cd5555">&#34;Ops hook it by mi1itray.axe&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">main</span>()<span style="color:#bbb"> </span>-&gt; <span style="color:#658b00">Result</span>&lt;(),<span style="color:#bbb"> </span><span style="color:#658b00">Box</span>&lt;<span style="color:#8b008b;font-weight:bold">dyn</span><span style="color:#bbb"> </span>Error&gt;&gt;{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">let</span><span style="color:#bbb"> </span>func_1<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>get_func_address(<span style="color:#b452cd">0x52c4</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb"> </span>HookIt.initialize(func_1,<span style="color:#bbb"> </span>detour)?.enable()<span style="color:#bbb"> </span>}?;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#658b00">Ok</span>(())<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#1e889b">#[no_mangle]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">extern</span><span style="color:#bbb"> </span><span style="color:#cd5555">&#34;system&#34;</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">fn</span> <span style="color:#008b45">DllMain</span>(_hinst: <span style="color:#008b45;font-weight:bold">HANDLE</span>,<span style="color:#bbb"> </span>reason: <span style="color:#00688b;font-weight:bold">u32</span>,<span style="color:#bbb"> </span>_reserved: *<span style="color:#8b008b;font-weight:bold">mut</span><span style="color:#bbb"> </span>c_void)<span style="color:#bbb"> </span>-&gt; <span style="color:#008b45;font-weight:bold">BOOL</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">match</span><span style="color:#bbb"> </span>reason<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_PROCESS_ATTACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>println!(<span style="color:#cd5555">&#34;attaching&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#8b008b;font-weight:bold">unsafe</span><span style="color:#bbb"> </span>{<span style="color:#bbb"> </span>main().unwrap()<span style="color:#bbb"> </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_PROCESS_DETACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>println!(<span style="color:#cd5555">&#34;detaching&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_THREAD_ATTACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#00688b">DLL_THREAD_DETACH</span><span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>_<span style="color:#bbb"> </span>=&gt;<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#00688b">BOOL</span>::from(<span style="color:#8b008b;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></div><h1 id="ÂèÇËÄÉ">ÂèÇËÄÉ</h1>
<p><a href="https://blog.csdn.net/kunyus/article/details/108884016">‰ΩøÁî®RustÁºñÂÜô Windows dll Âπ∂Ê≥®ÂÖ•ËøõÁ¨¨‰∏âÊñπËøõÁ®ãÂêéÂØπ Windows API MessageBoxW ËøõË°å Hook | CSDN</a></p>
<p><a href="https://microsoft.github.io/windows-docs-rs/doc/windows/index.html">windows-rs crate doc | microsoft.github.io</a></p>
<p><a href="https://blog.csdn.net/weixin_43695321/article/details/132241468">rust x84 windowsÁºñËØëÊä•Èîô | CSDN</a></p>
<p><a href="https://www.ired.team/offensive-security/code-injection-process-injection/import-adress-table-iat-hooking">Red Team note | ired.team</a></p>
<p><a href="https://github.com/Hpmason/retour-rs">retour-rs | github.com</a></p>
<p><a href="https://www.cnblogs.com/Mered1th/p/10924545.html">Ê∑±ÂÖ•ÁêÜËß£C++ËôöÂáΩÊï∞Ë°® | cnblogs.com</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/75172640">C++ ËôöÂáΩÊï∞Ë°®ÂâñÊûê | Áü•‰πé</a></p>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2024-03-22</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/post/%E5%8F%A5%E6%9F%84%E9%99%8D%E6%9D%83%E7%BB%95%E8%BF%87callbacks%E6%A3%80%E6%9F%A5/">
			Next<br>Âè•ÊüÑÈôçÊùÉÁªïËøáCallBacksÊ£ÄÊü•
                </a>
                
                
                
                <a class="older-posts" href="/post/%E5%88%A9%E7%94%A8peb%E9%81%8D%E5%8E%86%E6%A8%A1%E5%9D%97%E9%93%BE%E8%A1%A8/">
			Previous<br>Âà©Áî®PEBÈÅçÂéÜÊ®°ÂùóÈìæË°®
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












<script src="https://giscus.app/client.js"
        data-repo="username/repo"
        data-repo-id="**************************"
        data-category="General"
        data-category-id="*********************"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://military-axe.github.io/">
    
        <div class="nav-title">
            Mi1itray.axe
        </div>
        
        <div class="nav-subtitle">
            mi1itray.axe@gmail.com
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	mi1itray.axe copyright.
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#rust-windows-rs-%e5%ba%93%e4%bd%bf%e7%94%a8" class="nav-rust-windows-rs-Â∫ì‰ΩøÁî®">
									Rust windows-rs Â∫ì‰ΩøÁî®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#features" class="nav-features">
									features
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#32%e4%bd%8d--64%e4%bd%8d--dll" class="nav-32‰Ωç--64‰Ωç--dll">
									32‰Ωç &amp; 64‰Ωç &amp; DLL
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#iat-hook" class="nav-iat-hook">
									IAT hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#inline-hook" class="nav-inline-hook">
									Inline hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#vmt-hook" class="nav-vmt-hook">
									VMT hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%82%e8%80%83" class="nav-ÂèÇËÄÉ">
									ÂèÇËÄÉ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	mi1itray.axe copyright.
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
